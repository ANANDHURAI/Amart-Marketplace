{% extends "aadmin/admin-base.html" %}
{% load static %}

{% block content %}
<div class="content-wrapper bg-light">
    <div class="content">
        <div class="d-flex align-items-center justify-content-between mb-4">
            <div>
                <h2 class="font-weight-bold text-dark mb-1">Inventory Management</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent p-0" style="font-size: 0.85rem;">
                        <li class="breadcrumb-item"><a href="#" class="text-muted">Dashboard</a></li>
                        <li class="breadcrumb-item active text-primary font-weight-bold">Inventory</li>
                    </ol>
                </nav>
            </div>

            <div class="d-flex align-items-center">
                <div class="bg-white border rounded shadow-sm d-flex p-1 mr-3">
                    <form method="get" class="form-inline">
                        <input type="text" class="form-control form-control-sm border-0 bg-transparent" placeholder="Search products..." name="search" value="{{ search_query }}">
                        <button class="btn btn-sm btn-light border-0" type="submit">
                            <i class="mdi mdi-magnify"></i>
                        </button>
                    </form>
                </div>

                <a href="{% url 'add_inventory' %}" class="btn btn-primary shadow-sm px-4 py-2" style="border-radius: 8px; font-weight: 600;">
                    <i class="mdi mdi-plus-box mr-1"></i> Add Inventory
                </a>
            </div>
        </div>

        <div class="card border-0 shadow-sm" style="border-radius: 15px; overflow: hidden;">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table id="hoverable-data-table" class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th class="py-4 text-dark font-weight-bold border-0 pl-4">PRODUCT NAME</th>
                                <th class="py-4 text-dark font-weight-bold border-0 text-center">SIZE</th>
                                <th class="py-4 text-dark font-weight-bold border-0 text-center">PRICE</th>
                                <th class="py-4 text-dark font-weight-bold border-0 text-center">STOCK</th>
                                <th class="py-4 text-dark font-weight-bold border-0 text-center">STATUS</th>
                                <th class="py-4 text-dark font-weight-bold border-0 text-center pr-4">ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white">
                            {% for item in page_obj %}
                            <tr>
                                <td class="align-middle pl-4 font-weight-bold text-dark">
                                    {{ item.product.name }}
                                </td>
                                <td class="align-middle text-center">
                                    <span class="size-badge size-{{ item.get_size_display|slugify }}">
                                        {{ item.get_size_display }}
                                    </span>
                                </td>
                                <td class="align-middle text-center text-dark font-weight-bold">
                                    â‚¹ {{ item.price }}
                                </td>
                                <td class="align-middle text-center">
                                    <span class="stock-badge-uniform">{{ item.stock }}</span>
                                </td>
                                <td class="align-middle text-center">
                                    {% if item.is_active %}
                                        <span class="badge-success-soft"><i class="mdi mdi-check-circle mr-1"></i>Active</span>
                                    {% else %}
                                        <span class="badge-danger-soft"><i class="mdi mdi-close-circle mr-1"></i>Inactive</span>
                                    {% endif %}
                                </td>
                                <td class="align-middle text-center pr-4">
                                    <div class="btn-group shadow-sm" style="border-radius: 8px; overflow: hidden;">
                                        <a href="{% url 'edit_inventory' item.id %}" class="btn btn-sm btn-white border-right" title="Edit">
                                            <i class="mdi mdi-pencil text-warning"></i>
                                        </a>
                                        <a href="{% url 'inventory_status' item.id %}" class="btn btn-sm btn-white border-right" title="Toggle Status">
                                            {% if item.is_active %}
                                                <i class="mdi mdi-eye-off text-info"></i>
                                            {% else %}
                                                <i class="mdi mdi-eye text-primary"></i>
                                            {% endif %}
                                        </a>
                                        <button type="button" class="btn btn-sm btn-white" onclick="confirmDelete('{{ item.id }}', '{{ item.product.name }}')" title="Delete">
                                            <i class="mdi mdi-delete text-danger"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center py-5 text-muted">
                                    <i class="mdi mdi-archive-outline d-block mb-2" style="font-size: 3rem; opacity: 0.3;"></i>
                                    No inventory items found.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-rounded justify-content-center">
                    {% if page_obj.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}"><i class="mdi mdi-chevron-double-left"></i></a></li>
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"><i class="mdi mdi-chevron-left"></i></a></li>
                    {% endif %}
                    
                    <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>

                    {% if page_obj.has_next %}
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"><i class="mdi mdi-chevron-right"></i></a></li>
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}"><i class="mdi mdi-chevron-double-right"></i></a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_styles %}
<style>
    body { background-color: #f8f9fa !important; }
    
    /* Table Header Visibility */
    #hoverable-data-table thead th {
        background-color: #ffffff !important;
        color: #333333 !important;
        font-size: 0.7rem;
        letter-spacing: 0.05rem;
        border-bottom: 2px solid #f1f1f1 !important;
        text-transform: uppercase;
    }

    /* Uniform Stock Badge */
    .stock-badge-uniform {
        background-color: #f1f3f9 !important;
        color: #495057 !important;
        padding: 5px 12px;
        border-radius: 6px;
        font-weight: 700;
        display: inline-block;
        border: 1px solid #e5e9f2;
    }

    /* Status Badges */
    .badge-success-soft { background: #e6f4ea; color: #1e7e34; padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .badge-danger-soft { background: #fce8e6; color: #d93025; padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }

    /* Button Group UI */
    .btn-white { background: white; border: none; padding: 8px 12px; }
    .btn-white:hover { background: #f8f9fa; }
    
    .pagination-rounded .page-link { border-radius: 50% !important; margin: 0 3px; border: none; background: white; color: #4c84ff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .pagination-rounded .page-item.active .page-link { background: #4c84ff; color: white; }

    /* Base style for all size badges */
    .size-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        min-width: 60px;
        border: 1px solid rgba(0,0,0,0.05);
    }

    /* Color Coding for Sizes */
    .size-small { background-color: #e3f2fd; color: #1976d2; }       /* Blue */
    .size-medium { background-color: #f3e5f5; color: #7b1fa2; }      /* Purple */
    .size-large { background-color: #e8f5e9; color: #388e3c; }       /* Green */
    .size-extra-large { background-color: #fff3e0; color: #f57c00; } /* Orange */
    .size-double-extra-large { background-color: #ffebee; color: #d32f2f; } /* Red */

    /* Default for any other size */
    .size-badge:not([class*="size-"]) {
        background-color: #f8f9fa;
        color: #6c757d;
    }
</style>
{% endblock extra_styles %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
    function confirmDelete(id, itemName) {
        Swal.fire({
            title: 'Delete Item?',
            text: "Are you sure you want to remove " + itemName + " from inventory?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#fe5455',
            cancelButtonColor: '#333',
            confirmButtonText: 'Yes, delete'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = `/aadmin/inventory/delete/${id}/`;
            }
        });
    }
</script>
{% endblock extra_scripts %}