{% extends "aadmin/admin-base.html" %}
{% load static %}

{% block content %}

<style>
/* ===== Category List Styling ===== */
.category-wrapper {
    background: #ffffff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px; /* Increased margin for breathing room */
}

.category-header h1 {
    font-weight: 600;
    margin-bottom: 0;
}

/* Added Styling for Add Button */
.btn-add-category {
    background-color: #4c84ff;
    color: white;
    font-weight: 500;
    border-radius: 8px;
    padding: 8px 16px;
    transition: all 0.3s ease;
    border: none;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-add-category:hover {
    background-color: #3367d6;
    color: white;
    box-shadow: 0 4px 12px rgba(76, 132, 255, 0.3);
    transform: translateY(-1px);
}

.category-img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 10px;
    border: 1px solid #ddd;
}

.badge-active {
    background: #e6fffa;
    color: #065f46;
    padding: 4px 10px;
    border-radius: 14px;
    font-size: 12px;
}

.badge-deleted {
    background: #fee2e2;
    color: #991b1b;
    padding: 4px 10px;
    border-radius: 14px;
    font-size: 12px;
}

.action-btns a {
    margin: 0 4px;
}

.table thead th {
    vertical-align: middle;
}

.empty-state {
    text-align: center;
    padding: 40px;
    color: #888;
}

/* Align form and button */
.header-actions {
    display: flex;
    align-items: center;
    gap: 15px;
}
</style>

<div class="category-wrapper">

    <div class="category-header">
        <h1>Categories</h1>

        <div class="header-actions">
            <form method="get" class="form-inline">
                <input type="text"
                       name="search"
                       value="{{ search_query }}"
                       class="form-control form-control-sm mr-2"
                       placeholder="Search category">

                <select name="filter_option"
                        class="form-control form-control-sm mr-2"
                        onchange="this.form.submit()">
                    <option value="listed_categories"
                        {% if filter_option == "listed_categories" %}selected{% endif %}>
                        Listed Categories
                    </option>
                    <option value="deleted_categories"
                        {% if filter_option == "deleted_categories" %}selected{% endif %}>
                        Deleted Categories
                    </option>
                </select>
            </form>

            <a href="{% url 'add_category' %}" class="btn-add-category">
                <i class="mdi mdi-plus-circle"></i> Add Category
            </a>
        </div>
    </div>

    <table class="table table-hover">
        <thead class="thead-dark">
            <tr>
                <th class="text-center">Image</th>
                <th>Name</th>
                <th class="text-center">Products</th>
                {% if filter_option == "deleted_categories" %}
                    <th class="text-center">Deleted At</th>
                {% endif %}
                <th class="text-center">Action</th>
            </tr>
        </thead>

        <tbody>
        {% for category in categories %}
            <tr>
                <td class="text-center">
                    {% if category.image %}
                        <img src="{{ category.image.url }}" class="category-img">
                    {% else %}
                        <span class="text-muted">No Image</span>
                    {% endif %}
                </td>

                <td>
                    <strong>{{ category.name }}</strong><br>
                    {% if filter_option == "deleted_categories" %}
                        <span class="badge-deleted">Deleted</span>
                    {% else %}
                        <span class="badge-active">Active</span>
                    {% endif %}
                </td>

                <td class="text-center">{{ category.count }}</td>

                {% if filter_option == "deleted_categories" %}
                    <td class="text-center">{{ category.deleted_at|date:"d M Y" }}</td>
                {% endif %}

                <td class="text-center action-btns">
                    {% if filter_option == "deleted_categories" %}
                        <a href="{% url 'restore_category' category.slug %}"
                        class="btn btn-sm btn-outline-success"
                        onclick="return confirm('Restore this category?')">
                        Restore
                        </a>

                    {% else %}
                        <a href="{% url 'edit_category' category.slug %}"
                           class="btn btn-sm btn-outline-warning">
                            Edit
                        </a>
                        <a href="{% url 'delete_category' category.slug %}"
                            class="btn btn-sm btn-outline-danger"
                            onclick="return confirm('Are you sure you want to delete this category?')">
                            Delete
                        </a>
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="5" class="empty-state">
                    No categories found
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <nav>
        <ul class="pagination justify-content-center">
            {% if categories.has_previous %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ categories.previous_page_number }}&search={{ search_query }}&filter_option={{ filter_option }}">
                        &laquo;
                    </a>
                </li>
            {% endif %}

            <li class="page-item active">
                <span class="page-link">
                    {{ categories.number }} / {{ categories.paginator.num_pages }}
                </span>
            </li>

            {% if categories.has_next %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ categories.next_page_number }}&search={{ search_query }}&filter_option={{ filter_option }}">
                        &raquo;
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>

</div>

{% endblock %}