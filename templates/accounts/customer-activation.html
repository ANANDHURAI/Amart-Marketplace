{% extends "home/base.html" %}
{% load static %}

{% block content %}
<section class="signin-page account">
  <div class="container">
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <div class="block text-center">

          <a class="logo" href="{% url 'home' %}">
            <img style="width:150px" src="{% static 'images/logo-no-background.png' %}">
          </a>

          <h2>OTP Verification</h2>

          <!-- âœ… Messages -->
          {% if messages %}
            <div id="msg-box">
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} auto-hide text-center">
                  {{ message }}
                </div>
              {% endfor %}
            </div>
          {% endif %}

          <p>Please check your email for the OTP.</p>

          <form method="post">
            {% csrf_token %}

            <div class="form-group">
              <input
                type="text"
                name="otp"
                maxlength="6"
                pattern="[0-9]{6}"
                class="form-control"
                placeholder="Enter 6-digit OTP"
                required>
            </div>

            {% if time_left > 0 %}
              <p>
                OTP expires in
                <span id="countdowntimer">{{ time_left }}</span>
                seconds
              </p>
            {% else %}
              <p>
                <a href="{% url 'resend_otp' %}">
                  Resend OTP
                </a>
              </p>
            {% endif %}

            <button type="submit" class="btn btn-main btn-block">
              Verify
            </button>
          </form>

        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
  // Countdown timer
  let timeLeft = {{ time_left }};
  const timer = setInterval(() => {
    if (timeLeft <= 0) {
      clearInterval(timer);
      return;
    }
    timeLeft--;
    document.getElementById("countdowntimer").innerText = timeLeft;
  }, 1000);

  // Auto-hide messages (1.5 sec)
  setTimeout(() => {
    document.querySelectorAll(".auto-hide").forEach(msg => {
      msg.style.opacity = "0";
      setTimeout(() => msg.remove(), 400);
    });
  }, 1500);
</script>
{% endblock %}
